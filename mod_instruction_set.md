# ะญัะพั ะฒัะฟะพะผะพะณะฐัะตะปัะฝัะน ัะฐะนะป ะฟะพ ะดะธะฐะปะตะบัั Coco ัะทัะบะฐ ะััะตะผะฑะปะตัะฐ ัะพะทะดะฐะฝ ัััะดะตะฝัะพะผ 24940 ะณััะฟะฟั  ะะตัะฐััะพะฝะธะบะธ ะธ ะะพะฑะพัะพัะตัะฝะธะบะธ ;) "ะกะฟะฐัะธะฑะพ" ััะดะฐ ๐ [github](https://github.com/McAshesha) ะธ [telegram](https://t.me/McAshesha)

## ๐ โ ะะะะะะะซ ะะะะะขะซ ะก ะะะะะกะขะะะะ

- `ldi <to_reg>, <smth>` โ (LoaD Immediate) ะทะฐะฟะธัะฐัั ััะพ-ัะพ (`<smth>`) ะฒ ัะตะณะธััั `<to_reg>` ๐
- `ld <from>, <to>` โ (LoaD) ััะธัะฐัั ะธะท ะฟะฐะผััะธ ๐พ (ะฐะดัะตั ะฒ ัะตะณะธัััะต `<from>`) ะธ ะทะฐะฟะธัะฐัั ะฒ ัะตะณะธััั `<to>` ๐ฅ
- `st <to>, <from>` โ (STore) ะทะฐะฟะธัะฐัั ะฒ ะฟะฐะผััั ๐พ (ะฐะดัะตั ะฒ ัะตะณะธัััะต `<to>`) ะดะฐะฝะฝัะต ะธะท ัะตะณะธัััะฐ `<from>` ๐ค
- `move <from>, <to>` โ (move) ัะบะพะฟะธัะพะฒะฐัั ะทะฝะฐัะตะฝะธะต ะธะท ัะตะณะธัััะฐ `<from>` ะฒ ัะตะณะธััั `<to>` ๐

### ๐ ะัะธะผะตัั:

- `ldi r0, a` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `r0 = &a;` (ัะทะฝะฐัะผ ะฐะดัะตั ะฒ ะฟะฐะผััะธ, ะณะดะต ะปะตะถะธั `a`) ๐บ๏ธ
- `ld r0, r1` โ ะฐะฝะฐะปะพะณ ะฝะฐ C:
  ```c
  r0 = &a;
  r1 = scanf("%d", r0);
  ```
  ะะปะธ ะผะพะถะฝะพ ัะฐะบ:
  ```c
  r1 = scanf("%d", &a);
  ```
- `st r0, r1` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `int *r0 = r1;` (ะฟะพ ะฐะดัะตัั `r0` ะทะฐะฟะธััะฒะฐะตะผ ัะธัะปะพ `r1`) โ๏ธ
- `move r0, r1` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `r1 = r0` ๐

## โ โ ARITHMETIC

- `clr rn` โ (CLeaR) ะพัะธััะบะฐ ัะตะณะธัััะฐ (ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn = 0`) ๐๏ธ
- `add rn, rm` โ (ADD) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rm = rn + rm` โ
- `sub rn, rm` โ (SUBtract) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rm = rn - rm` โ
- `addc rn, rm` โ (ADD + C) ัะพ ะถะต, ััะพ ะธ `add`, ะฝะพ ะดะพะฑะฐะฒะปัะตั ะทะฝะฐัะตะฝะธะต ะฑะธัะฐ `C` (ะฑะธั ะฟะตัะตะฝะพัะฐ), ะพััะฐะฒัะตะตัั ะฟะพัะปะต ะฟัะตะดัะตััะฒัััะตะน ะพะฟะตัะฐัะธะธ ๐ณ๏ธ
- `inc rn` โ (INCrement) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn++;` โฌ๏ธ
- `dec rn` โ (DECrement) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn--;` โฌ๏ธ
- `neg rn` โ (NEGative) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn = -rn;` ๐
- `shra rn` โ (SHift Right Arithmetic) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn >> 1` (ะฑะธัะพะฒัะน ัะดะฒะธะณ ะฝะฐ 1 ะฒะฟัะฐะฒะพ; ัะพ ะถะต ััะพ ะธ ัะตะปะพัะธัะปะตะฝะฝะพะต ะดะตะปะตะฝะธะต ะฝะฐ 2). **ะะฐะถะฝะพ**: ะฑะธั ะทะฝะฐะบะฐ ัะพััะฐะฝัะตััั. ะัะธะผะตั:
  ```
  shra 0b1001_0101 >>> 0b1100_1010  // "_" ะดะปั ัะดะพะฑััะฒะฐ ััะตะฝะธั
  ```
- `shla rn` โ (SHift Left Arithmetic) ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn << 1` (ะฑะธัะพะฒัะน ัะดะฒะธะณ ะฝะฐ 1 ะฒะปะตะฒะพ; ัะพ ะถะต ััะพ ะธ ัะผะฝะพะถะตะฝะธะต ะฝะฐ 2). **C-bit** = ัะฐะผัะน ะปะตะฒัะน ะฑะธั ะฟะตัะตะดะฐะฝะฝะพะณะพ ัะธัะปะฐ. ๐
- `shr rn` โ ัะพ ะถะต ััะพ ะธ `shra`, ะฝะพ ะฑะธั ะทะฝะฐะบะฐ ะฝะต ัะพััะฐะฝัะตััั (ััะฒะตัะถะดะตะฝะธะต ะพัะฝะพะฒะฐะฝะพ ะฝะฐ ะฟะฐัะพัะบะต ะพะฟััะพะฒ) ๐
- `shl rn` โ ัะพ ะถะต ััะพ ะธ `shla`, ะฒัะพะดะต (ะฝะพ ะฟะพะดัะฒะตัะธะฒะฐะตััั ัะธะพะปะตัะพะฒัะผ, ะบะฐะบ ะผะฐะบัะพั) ๐ก
- `rol rn` โ (ROtate Left) ัะพั ะถะต `shla rn`, ะฝะพ ัะฐะผัะน ะฟัะฐะฒัะน ะฑะธั ััะฐะฝะตั ะฝะต 0, ะฐ ะฒะพะทัะผัั ะทะฝะฐัะตะฝะธะต ะธะท ัะฐะผะพะณะพ ะปะตะฒะพะณะพ ะฑะธัะฐ (ัะฐะบ ะถะต ะบะฐะบ ะธ ะฑะธั `C` ะธะท `CVZN`) ๐
- `cmp rn, rm` โ (CoMPare) ะผั ะฟัะพััะพ ะธะผะตะตะผ ัะธัะปะพ `rn - rm`, ะฝะพ ะฑะธัั `CVZN` ะผะตะฝััััั. ะั ะธะทะผะตะฝะตะฝะธะต ะฝะฐั ะธ ะธะฝัะตัะตััะตั (ะฟัะฐะฒะดะฐ, ั ะฝะต ะทะฝะฐั ะบะฐะบ ะธั ััะธััะฒะฐัั...) โ๏ธ

## โ ๐งฎ LOGICAL (bitwise / ะฟะพะฑะธัะพะฒะพะต)

- `and rn, rm` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `rm = rn & rm` (ะฟะพะฑะธัะพะฒะฐั ะบะพะฝััะฝะบัะธั [AND]) ๐
- `or rn, rm` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `rm = rn | rm` (ะฟะพะฑะธัะพะฒะฐั ะดะธะทััะฝะบัะธั [OR]) ๐
- `xor rn, rm` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `rm = rn ^ rm` (ะฟะพะฑะธัะพะฒะฐั ะธัะบะปััะฐััะฐั ะดะธะทััะฝะบัะธั [XOR]) โ
- `not rn` โ ะฐะฝะฐะปะพะณ ะฝะฐ C: `rn = ~rn` (ะฟะพะฑะธัะพะฒะพะต ะพััะธัะฐะฝะธะต [NOT]). ะัะธะผะตั: `~5 = -6` (ะฟัะพะธััะพะดะธั ัะผะตัะตะฝะธะต) ๐ซ

## โ ๐ฆ ะะะะะะะะะซะ ะธ ะฒัะดะตะปะตะฝะธะต ะฟะฐะผััะธ

- `a: dc 23` โ ะฒ ััะตะนะบั ะฟะฐะผััะธ (1 ะฑะฐะนั) ะทะฐะฟะธัะฐัั ัะธัะปะพ `23` ๐๏ธ
  - ะะฐะบ ะฝะฐะนัะธ ััะตะนะบั: `ldi rn, a` (ะฒ ัะตะณะธััั `rn` ะทะฐะฟะธัะตะผ ะฐะดัะตั ะฟะฐะผััะธ ั ััะธะผ ัะธัะปะพะผ) ๐
- `b: ds 1` โ ะทะฐัะตะทะตัะฒะธัะพะฒะฐัั 1 ะฑะฐะนั ะฟะฐะผััะธ ๐ฆ
  - ะะฐะบ ะฝะฐะนัะธ ััะตะนะบั: `ldi rn, b` ๐
- `c: ds n` โ ะทะฐัะตะทะตัะฒะธัะพะฒะฐัั `n` ะฑะฐะนั ะฟะฐะผััะธ ๐ฆ๐ฆ๐ฆ
  - ะะฐะบ ะฝะฐะนัะธ ััะตะนะบั: `ldi rn, c` ๐งญ

---

### ๐ ะกะปะพะฒะฐัั:

- `rn` โ ะบะฐะบะพะน-ัะพ ัะตะณะธััั ๐
- `offset` โ ัะผะตัะตะฝะธะต โ๏ธ
- `PC` โ ะฐะดัะตั ะฒ ะฟะฐะผััะธ, ะบะพะผะฐะฝะดะฐ ะบะพัะพัะฐั ะฑัะดะตั ะฒัะฟะพะปะฝััััั ๐ฅ๏ธ
- `SP` โ ะฐะดัะตั ะฟะฐะผััะธ, ะพัะบัะดะฐ `pop` ๐๏ธ
- `<const>` โ ะบะฐะบะฐั-ัะพ ะผะตัะบะฐ (`label`), ะฝะฐะฟัะธะผะตั, `mult` ๐ท๏ธ
- `!` โ `not` (ะพััะธัะฐะฝะธะต ะฟะตัะตะผะตะฝะฝะพะน) โ

---

### โ๏ธ ะฃัะปะพะฒะธั ะดะปั `is` / `stays` / `until`:

| ะฃัะปะพะฒะธะต   | ะคะปะฐะณ         | ะะฝัะตัะฟัะตัะฐัะธั                                                          |
|-----------|--------------|------------------------------------------------------------------------|
| `eq`/`z`  | `Z`          | equal, equal zero (`rj == ri` / `rn == 0`) โ
| `ne`/`nz` | `!Z`         | not equal, not zero (`ri != rj`, `rn != 0`) โ
| `hs`/`cs` | `C`          | unsigned higher or same (ะฑะตะทะทะฝะฐะบะพะฒะพะต `>=`) ๐
| `lo`/`cc` | `!C`         | unsigned lower (ะฑะตะทะทะฝะฐะบะพะฒะพะต `<`, ะฝะฐะฟัะธะผะตั, `17 < 193` ะฒัะฟะพะปะฝะธััั ะฑะปะพะบ `is`) ๐
| `hi`      | `(C & !Z)`   | unsigned higher (ะฑะตะทะทะฝะฐะบะพะฒะพะต `>`) ๐ผ
| `ls`      | `(!C or Z)`  | unsigned lower or same (ะฑะตะทะทะฝะฐะบะพะฒะพะต `<=`) ๐ฝ
| `mi`      | `N`          | negative (ะตัะปะธ ัะธัะปะพ `< 0`, ัะธัะปะพ โ `[-128; -1]`) โ
| `pl`      | `!N`         | positive or zero (ะตัะปะธ ัะธัะปะพ `>= 0`, ัะธัะปะพ โ `[0; 127]`) โ
| `vs`      | `V`          | overflow is set (ะตัะปะธ ะฟัะธ ัะปะพะถะตะฝะธะธ ะดะฒัั ะฟะพะปะพะถะธัะตะปัะฝัั ัะธัะตะป ะฟะพะปััะธะปะพัั ะพััะธัะฐัะตะปัะฝะพะต, ะธะปะธ ะฝะฐะพะฑะพัะพั โ ัะปะพะถะธะปะธ ะดะฒะฐ ะพััะธัะฐัะตะปัะฝัั ัะธัะปะฐ ะธ ะฟะพะปััะธะปะธ ะฟะพะปะพะถะธัะตะปัะฝะพะต) ๐
| `vc`      | `!V`         | overflow is clear (ัะปะพะถะธะปะธ ะพััะธัะฐัะตะปัะฝัะต ัะธัะปะฐ ะธ ะฟะพะปััะธะปะธ ะพััะธัะฐัะตะปัะฝะพะต, ะธะปะธ ัะปะพะถะธะปะธ ะดะฒะฐ ะฟะพะปะพะถะธัะตะปัะฝัั ัะธัะปะฐ ะธ ะฟะพะปััะธะปะพัั ะฟะพะปะพะถะธัะตะปัะฝะพะต) ๐
| `ge`      | `(N & V) or (!N & !V)` | greater than or equal (ะทะฝะฐะบะพะฒะพะต `>=`) ๐
| `lt`      | `(N & !V) or (!N & V)` | less than (ะทะฝะฐะบะพะฒะพะต `<`) ๐
| `gt`      | `(!Z & N & V) or (!Z & !N & !V)` | greater than (ะทะฝะฐะบะพะฒะพะต `>`) ๐ผ
| `le`      | `(Z or N & !V) or (!N & V)` | less than or equal (ะทะฝะฐะบะพะฒะพะต `<=`) ๐ฝ

---

### ๐ `if`, `while`, `do-until`

ะคะพัะพ ั ััะปะพะฒะธัะผะธ ะดะปั `is`, `stays` ะธ `until` (ะปะธะฑะพ ัะฟะธัะพะบ ะฒ ะฝะฐัะฐะปะต ัะฐะนะปะฐ): [ัััะปะบะฐ](https://disk.yandex.ru/i/4W4sBW3ArUntVw)

#### ะกัััะบัััะฐ:

**if**

- ะะพะดะณะพัะพะฒะธัะตะปัะฝัะต ะดะตะนััะฒะธั, ะฟัะธะผะตัั: `tst rn` / `cmp ri, rj` (ะฟะพ ัะฐะบัั `sub ri, rj`, ะฝะพ `rj` ะฝะต ะฟะตัะตะทะฐะฟะธัะตััั)

```assembly
if
  # ะฟะพะดะณะพัะพะฒะธัะตะปัะฝัะต ะดะตะนััะฒะธั
is <ััะปะพะฒะธะต>
  # do something ๐๏ธ
fi  # ะทะฐะบัััั if
```

**while**

- ะะพะดะณะพัะพะฒะธัะตะปัะฝัะต ะดะตะนััะฒะธั, ะฟัะธะผะตัั: `tst rn` / `cmp ri, rj`

```assembly
while
  # ะฟะพะดะณะพัะพะฒะธัะตะปัะฝัะต ะดะตะนััะฒะธั
stays <ััะปะพะฒะธะต>  # ัะพั ะถะต `is`, ะฝะพ ะดะปั `while`
  # do something ๐
wend  # ะทะฐะบัััั while
```

**do-until**

```assembly
do
  # do something ๐
until <ััะปะพะฒะธะต>  # ััะปะพะฒะธั ัะฐะบะธะต ะถะต, ะบะฐะบ ะดะปั `is` ะธ `stays`
```

**CONTINUE** ะธ **BREAK** ัะฐะฑะพัะฐัั ัะฐะบะถะต ะบะฐะบ ะฒ C:

- `continue` โ ะฟะตัะตัะพะดะธั ะบ ัะปะตะดัััะตะน ะธัะตัะฐัะธะธ ัะธะบะปะฐ โฉ
- `break` โ ะฒััะพะดะธั ะธะท ัะธะบะปะฐ ะธ ะฒัะฟะพะปะฝัะตั ัะปะตะดััััั ะบะพะผะฐะฝะดั โน๏ธ

---

### ๐ ะกะขะะ

ะกัะตะบ ัะฐะฑะพัะฐะตั ั ะบะพะฝัะฐ: ัะฝะฐัะฐะปะฐ ะทะฝะฐัะตะฝะธะต ะบะปะฐะดัััั ะฒ ััะตะนะบั `0xFF`, ะทะฐัะตะผ โ ะฒ `0xFE`, ะฟะพัะปะต โ `0xFD` ะธ ัะฐะบ ะดะฐะปะตะต. ๐ฅ

- `push rn` โ ะฐะฝะฐะปะพะณ ะฝะฐ C:
  ```c
  SP--;
  *SP = rn;
  ```
- `pop rn` โ ะฐะฝะฐะปะพะณ ะฝะฐ C:
  ```c
  rn = *SP;
  SP++;
  ```

---

### ๐ง ะััะณะธะต ะบะพะผะฐะฝะดั

- `asect <ัะธัะปะพ ะพั 0 ะดะพ 255>` โ "ะณะพะฒะพัะธั" ะบะพะผะฟะธะปััะพัั, ั ะบะฐะบะพะณะพ ะฐะดัะตัะฐ ะฝะฐัะฐัั ะฒััะฐะฒะปััั ะบะพะด ะฟัะพะณัะฐะผะผั. ะะฐะฟัะธะผะตั, ะฟัะธ `asect 0x00` ะบะพะผะฟะธะปััะพั ะฑัะดะตั ะฒััะฐะฒะปััั ะบะพะด ั ะฝะฐัะฐะปะฐ. ๐
- `rsect <const>` โ ะพะฑััะฒะปัะตั ะฝะฐัะฐะปะพ ะฟะพะดะฟัะพะณัะฐะผะผั ะฒ ะพัะดะตะปัะฝะพะผ ัะฐะนะปะต.

  **ะัะธะผะตั:**

  _ะ ะพัะดะตะปัะฝะพะผ ัะฐะนะปะต_:

  ```assembly
  rsect mul
  mul>  # ะธะผะตะฝะฝะพ "mul>" ะฐ ะฝะต "mul:", ัะฐะบ ะบะฐะบ ััะพ ะดะปั `rsect`
    push r2  # save r2 ๐พ
    ldi r2, 0  # clr r2 ๐๏ธ

    inc r1  # ะธะฝะฐัะต 1 ะธัะตัะฐัะธะธ ะฝะต ัะฒะฐัะฐะตั โฌ๏ธ
    while
      dec r1  # โฌ๏ธ
    stays ne
      add r0, r2  # โ
    wend
    move r2, r0  # result will be in r0 (r0 = r2) ๐
    pop r2  # restore r2 ๐พ

    rts  # go back ๐
  ```

  _ะ ะณะปะฐะฒะฝะพะผ ัะฐะนะปะต_ ััะธัะฐะตะผ `-3x + 7`:

  ```assembly
  asect 0  # ๐
  mul: ext  # ะพะฑััะฒะปัะตะผ ะผะตัะบั ะฒะฝะตัะฝะตะน (declare `mul` as an external label) ๐
  ldi r0, x  # \ ๐
  ld r0, r0  # / r0 = x
  ldi r1, -3  # r1 = -3 โ
  jsr mul  # goto mul, r0 = r0 * r1,  r0 = -3x ๐
  ldi r1, 7  # r1 = 7 โ
  add r1, r0  # r0 += r1,  r0 = -3x + 7 โ
  halt  # ๐
  x: dc <ัะธัะปะพ>  # ๐ฅ
  end  # ๐
  ```

- `tplate <name>` โ **ะฏ ะะ ะะะะฏะ**, ะฝะพ ะพะฑ ััะพะผ ะตััั ะฒ ะปะตะบัะธะธ 5. ะะตะบะธะน `malloc`, ะฟะธัะฐัั ะพะฑัะทะฐัะตะปัะฝะพ ะดะพ `asect <ัะธัะปะพ>`. ๐

---

### ๐๏ธ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะบะพะผะฐะฝะดั ัะฐะฑะพัั ัะพ ััะตะบะพะผ

- `addsp n` โ `SP += n` โ
- `ldsa rn, offset` โ `rn = SP + offset` ๐
- `ldsp rn` โ `rn = SP` ๐๏ธ
- `stsp rn` โ ะฝะต ะพัะตะฝั ัะฐะทะพะฑัะฐะปัั, ััะพ-ัะพ ะพัะตะฝั ัััะฐะฝะฝะพะต. ๐ค

  **ะัะธะผะตั:**

  ```assembly
  stsp r0  # ะฐะฝะฐะปะพะณ ะฝะฐ C: *SP = r1 ๐
  stsp r1  # ะฐะฝะฐะปะพะณ ะฝะฐ C: *SP = r0 ๐
  ```

---

### ๐ SUBROUTINES (ะฟะพะดะฟัะพะณัะฐะผะผั)

- `jsr <const>` โ ััะพ-ัะพ ะฟะพัะพะถะตะต ะฝะฐ `goto`, ัะฐะบะถะต ะบะปะฐะดัั ะฒ ััะตะบ, ะบัะดะฐ ะฒะตัะฝััััั. ๐งญ
  - ะัะธ ะฒัะทะพะฒะต `jsr`:
    ```assembly
    SP = SP - 1
    *SP = PC
    PC = <const>
    ```
- `rts` โ ะฑะตะท ะฐัะณัะผะตะฝัะพะฒ.
  - ะัะธ ะฒัะทะพะฒะต:
    ```assembly
    PC = *SP
    SP++
    ```
    ะะปะธ ะบะพัะพัะบะพ: `PC = pop(stack)`
- `jsrr rn` โ ะฐะฝะฐะปะพะณ `jsr`, ะฝะพ ะฒะผะตััะพ `<const>` ะธัะฟะพะปัะทัะตััั ะทะฝะฐัะตะฝะธะต ะธะท ัะตะณะธัััะฐ.

**ะัะธะผะตั ะบะพะดะฐ:**

```assembly
# main
ldi r0, 5  # r0 = 5 ๐
ldi r1, 4  # r1 = 4 ๐
jsr mult  # "goto mult" ๐
# ะฟะพัะปะต ััะพะณะพ r0 = r0 * r1

mult:
  push r2  # save r2 ๐พ
  ldi r2, 0  # clr r2 ๐๏ธ

  inc r1  # ะธะฝะฐัะต 1 ะธัะตัะฐัะธะธ ะฝะต ัะฒะฐัะฐะตั โฌ๏ธ
  while
    dec r1  # โฌ๏ธ
  stays ne
    add r0, r2  # r2 = r0 + r2 โ
  wend
  move r2, r0  # result will be in r0 (r0 = r2) ๐
  pop r2  # restore r2 ๐พ

  rts  # go back, ะฟัะพะดะพะปะถะธัั ะฒัะฟะพะปะฝััั ะบะพะผะฐะฝะดั ะฟะพัะปะต jsr mult ๐
# ะบะพะฝะตั ะฟัะธะผะตัะฐ
```

---